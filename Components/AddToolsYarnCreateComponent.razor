@rendermode InteractiveServer
@using ArtsAndCrafts.Data
@using Microsoft.EntityFrameworkCore
@using ArtsAndCrafts.Models

@if (yarnToAddList is null || toolToAddList is null || filteredYarns is null || filteredTools is null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="mb-3">
        Add yarn to pattern:
        <div class="card card-body" style="max-height: 200px; overflow: auto;">
            <input type="search" @bind="yarnFilter" @bind:event="oninput" />
            <ul class="list-group list-group-flush">
                @foreach (var yarn in filteredYarns)
                {
                    @if (yarnToAddList.Contains(yarn))
                    {
                        <li class="list-group-item flex-fill">
                            <button type="button" class="btn btn-danger" @onclick="@(e => yarnToAddList.Remove(yarn))">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                                </svg>
                            </button>
                            <a href=" @($"yarns/details?id={yarn.Id}")">@yarn.Name</a>
                        </li>
                    }
                    else
                    {
                        <li class="list-group-item flex-fill">
                            <button type="button" class="btn btn-success" @onclick="@(e => yarnToAddList.Add(yarn))">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                </svg>
                            </button>
                            <a href=" @($"yarns/details?id={yarn.Id}")">@yarn.Name</a>
                        </li>
                    }
                }
            </ul>
        </div>
    </div>

    <div class="mb-3">
        Add tool to pattern:
        <div class="card card-body" style="max-height: 200px; overflow: auto;">
            <input type="search" @bind="toolFilter" @bind:event="oninput" />
            <ul class="list-group list-group-flush">
                @foreach (var tool in filteredTools)
                {
                    @if (toolToAddList.Contains(tool))
                    {
                        <li class="list-group-item flex-fill">
                            <button type="button" class="btn btn-danger" @onclick="@(e => toolToAddList.Remove(tool))">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x" viewBox="0 0 16 16">
                                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                                </svg>
                            </button>
                            <a href=" @($"tools/details?id={tool.Id}")">@tool.Name</a>
                        </li>
                    }
                    else
                    {
                        <li class="list-group-item flex-fill">
                            <button type="button" class="btn btn-success" @onclick="@(e => toolToAddList.Add(tool))">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4" />
                                </svg>
                            </button>
                            <a href=" @($"tools/details?id={tool.Id}")">@tool.Name</a>
                        </li>
                    }
                }
            </ul>
        </div>
    </div>
}


@code {
    [Parameter]
    public List<Yarn> yarnToAddList { get; set; }
    [Parameter]
    public List<Tool>? toolToAddList { get; set; }

    [Parameter]
    public List<Yarn> yarnList { get; set; }
    [Parameter]
    public List<Tool>? toolList { get; set; }

    private string yarnFilter = string.Empty;
    private IEnumerable<Yarn>? filteredYarns;
    private string toolFilter = string.Empty;
    private IEnumerable<Tool>? filteredTools;

    protected override async Task OnInitializedAsync()
    {
        filteredYarns ??= yarnList.Where(y => y.Name.Contains(yarnFilter));
        filteredTools ??= toolList.Where(t => t.Name.Contains(toolFilter));
    }
}
